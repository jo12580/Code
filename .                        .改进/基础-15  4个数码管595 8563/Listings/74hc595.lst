C51 COMPILER V9.59.0.0   74HC595                                                           12/07/2019 22:30:57 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE 74HC595
OBJECT MODULE PLACED IN .\Objects\74hc595.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE 74hc595.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\7
                    -4hc595.lst) TABS(2) OBJECT(.\Objects\74hc595.obj)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          #include "74hc595.h"
   4          
   5          unsigned char year_2_h,year_2_l,month_2_h,month_2_l,day_2_h,day_2_l,
   6                hour_2_h,hour_2_l,min_2_h,min_2_l,sec_2_h,sec_2_l,week_2_h,week_2_l;
   7          int temp_int_2_h,temp_int_2_l,temp_float2int_2_h,temp_float2int_2_l;
   8          
   9          unsigned char code led_code[] =
  10          //{0xff,0xff,0x01,0x02,0x04,
  11          //0x08,0x10,0x20,0x40,0x80};  //此为测试代码
  12          
  13          { 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 
  14          0x82, 0xF8, 0x80, 0x90, 0x88, 0x83,
  15          0xC6, 0xA1, 0x86, 0x8E, 0xBF, 0x7F };
  16          
  17          
  18          //{ 0x82, 0xAF, 0xC4, 0x85, 0xA9, 0x91, 
  19          //0x90, 0xA7, 0x80, 0x81, 0xA0, 0x98, 
  20          //0xD2, 0x8C, 0xD0, 0xF0, 0xFD, 0x7F };
  21          
  22          
  23          void HC595SendData(unsigned char SendVal,unsigned char ctr)
  24          {  
  25   1        unsigned char i,m;
  26   1        m=led_code[SendVal];
  27   1      
  28   1        if(ctr==2) m=m&0xbf;//加个小数点  //1010 1101
  29   1            
  30   1        for(i=0;i<8;i++) 
  31   1        {
  32   2            SCK_595=0;
  33   2          if(m&0x80) 
  34   2          DATA_595=1;                                                                                             
             -                                                                                                                  //set 
             -dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  35   2          else 
  36   2          DATA_595=0;
  37   2          m=m<<1;
  38   2          SCK_595=1;  
  39   2          _nop_();   //短暂延时产生一定宽度的脉冲信号
  40   2          _nop_();   //短暂延时 
  41   2        }
  42   1        /*以下四条语句不能放在此函数里，不然会有闪烁感
  43   1        RCK_595=0; //set dataline low
  44   1        _nop_();  //短暂延时
  45   1        _nop_();  //短暂延时
  46   1        RCK_595=1;
  47   1        应放在显示函数的后面（每传输完一组数据再拉高）*/      
  48   1      }
  49          
  50          void display_time(unsigned char hour_2,min_2,sec_2,week_2)
  51          {
  52   1        hour_2_h=hour_2/10;
C51 COMPILER V9.59.0.0   74HC595                                                           12/07/2019 22:30:57 PAGE 2   

  53   1        hour_2_l=hour_2%10;
  54   1        min_2_h=min_2/10;
  55   1        min_2_l=min_2%10;
  56   1        sec_2_h=sec_2/10;
  57   1        sec_2_l=sec_2%10;
  58   1        week_2_h=week_2/10;
  59   1        week_2_l=week_2%10;
  60   1        
  61   1        HC595SendData(sec_2_l,1);
  62   1        HC595SendData(sec_2_h,1);
  63   1        HC595SendData(min_2_l,1);
  64   1        HC595SendData(min_2_h,1);
  65   1        HC595SendData(hour_2_l,1);
  66   1        HC595SendData(hour_2_h,1);
  67   1        HC595SendData(10,1);
  68   1        HC595SendData(week_2_l,1);
  69   1        
  70   1        RCK_595=0; //set dataline low
  71   1        _nop_();  //短暂延时
  72   1        _nop_();  //短暂延时
  73   1        RCK_595=1;
  74   1      
  75   1      }
  76          
  77          void display_date(unsigned char year_2,month_2,day_2)
  78          {
  79   1        year_2_h=year_2/10;
  80   1        year_2_l=year_2%10;
  81   1        month_2_h=month_2/10;
  82   1        month_2_l=month_2%10;
  83   1        day_2_h=day_2/10;
  84   1        day_2_l=day_2%10;
  85   1      
  86   1        HC595SendData(day_2_l,1);
  87   1        HC595SendData(day_2_h,1);
  88   1        HC595SendData(month_2_l,1);
  89   1        HC595SendData(month_2_h,1);
  90   1        HC595SendData(year_2_l,1);
  91   1        HC595SendData(year_2_h,1);
  92   1        HC595SendData(0,1);
  93   1        HC595SendData(2,1);
  94   1      
  95   1        RCK_595=0; //set dataline low
  96   1        _nop_();  //短暂延时
  97   1        _nop_();  //短暂延时
  98   1        RCK_595=1;
  99   1      }
 100          
 101          void display_temperature(int temp_int_2,temp_float2int_2)
 102          {
 103   1        temp_int_2_h=temp_int_2/10;
 104   1        temp_int_2_l=temp_int_2%10;
 105   1        temp_float2int_2_h=temp_float2int_2/10;
 106   1        temp_float2int_2_l=temp_float2int_2%10;
 107   1      
 108   1        HC595SendData(temp_float2int_2_l,1);
 109   1        HC595SendData(temp_float2int_2_h,1);
 110   1        HC595SendData(temp_int_2_l,2);//加个小数点
 111   1        HC595SendData(temp_int_2_h,1);
 112   1        HC595SendData(10,1);
 113   1        HC595SendData(10,1);
 114   1        HC595SendData(10,1);
C51 COMPILER V9.59.0.0   74HC595                                                           12/07/2019 22:30:57 PAGE 3   

 115   1        HC595SendData(10,1);
 116   1      
 117   1        RCK_595=0; //set dataline low
 118   1        _nop_();  //短暂延时
 119   1        _nop_();  //短暂延时
 120   1        RCK_595=1;
 121   1      }
 122          
 123          
 124          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    421    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
