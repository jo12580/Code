C51 COMPILER V9.01   74HC595                                                               01/18/2020 16:59:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 74HC595
OBJECT MODULE PLACED IN 74hc595.OBJ
COMPILER INVOKED BY: C:\软件\C51\BIN\C51.EXE 74hc595.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          #include "74hc595.h"
   4          
   5          unsigned char year_2_h,year_2_l,
   6                                    month_2_h,month_2_l,
   7                                    day_2_h,day_2_l,
   8                        hour_2_h,hour_2_l,
   9                                    min_2_h,min_2_l,
  10                                    sec_2_h,sec_2_l,
  11                                    week_2_h,week_2_l;
  12          int temp_int_2_h,temp_int_2_l,temp_float2int_2_h,temp_float2int_2_l;
  13          
  14          unsigned char code led_code[] =
  15          //{0xff,0xff,0x01,0x02,0x04,
  16          //0x08,0x10,0x20,0x40,0x80};  //此为测试代码
  17          
  18          { 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 
  19          0x82, 0xF8, 0x80, 0x90, 0x88, 0x83,
  20          0xC6, 0xA1, 0x86, 0x8E, 0xBF, 0x7F };
  21          
  22          
  23          //{ 0x82, 0xAF, 0xC4, 0x85, 0xA9, 0x91, 
  24          //0x90, 0xA7, 0x80, 0x81, 0xA0, 0x98, 
  25          //0xD2, 0x8C, 0xD0, 0xF0, 0xFD, 0x7F };
  26          
  27          
  28          void HC595SendData(unsigned char SendVal,unsigned char ctr)
  29          {  
  30   1              unsigned char i,m;
  31   1              m=led_code[SendVal];
  32   1      
  33   1              if(ctr==2) m=m&0xbf;//加个小数点  //1010 1101
  34   1                              
  35   1              for(i=0;i<8;i++) 
  36   1              {
  37   2                      SCK_595=0;
  38   2                      if(m&0x80) 
  39   2                      DATA_595=1;                                                                                             
             -                                                                                                                  //set 
             -dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  40   2                      else 
  41   2                      DATA_595=0;
  42   2                      m=m<<1;
  43   2                      SCK_595=1;  
  44   2                      _nop_();         //短暂延时产生一定宽度的脉冲信号
  45   2                      _nop_();         //短暂延时     
  46   2              }
  47   1              /*以下四条语句不能放在此函数里，不然会有闪烁感
  48   1              RCK_595=0; //set dataline low
  49   1              _nop_();  //短暂延时
  50   1              _nop_();  //短暂延时
  51   1              RCK_595=1;
  52   1              应放在显示函数的后面（每传输完一组数据再拉高）*/            
  53   1      }
C51 COMPILER V9.01   74HC595                                                               01/18/2020 16:59:08 PAGE 2   

  54          
  55          void display_time(unsigned char hour_2,min_2,sec_2,week_2)
  56          {
  57   1              hour_2_h=hour_2/10;
  58   1              hour_2_l=hour_2%10;
  59   1              min_2_h=min_2/10;
  60   1              min_2_l=min_2%10;
  61   1              sec_2_h=sec_2/10;
  62   1              sec_2_l=sec_2%10;
  63   1              week_2_h=week_2/10;
  64   1              week_2_l=week_2%10;
  65   1              
  66   1              HC595SendData(sec_2_l,1);
  67   1              HC595SendData(sec_2_h,1);
  68   1              HC595SendData(min_2_l,1);
  69   1              HC595SendData(min_2_h,1);
  70   1              HC595SendData(hour_2_l,1);
  71   1              HC595SendData(hour_2_h,1);
  72   1              HC595SendData(10,1);
  73   1              HC595SendData(week_2_l,1);
  74   1              
  75   1              RCK_595=0; //set dataline low
  76   1              _nop_();  //短暂延时
  77   1              _nop_();  //短暂延时
  78   1              RCK_595=1;
  79   1      
  80   1      }
  81          
  82          void display_date(unsigned char year_2,month_2,day_2)
  83          {
  84   1              year_2_h=year_2/10;
  85   1              year_2_l=year_2%10;
  86   1              month_2_h=month_2/10;
  87   1              month_2_l=month_2%10;
  88   1              day_2_h=day_2/10;
  89   1              day_2_l=day_2%10;
  90   1      
  91   1              HC595SendData(day_2_l,1);
  92   1              HC595SendData(day_2_h,1);
  93   1              HC595SendData(month_2_l,1);
  94   1              HC595SendData(month_2_h,1);
  95   1              HC595SendData(year_2_l,1);
  96   1              HC595SendData(year_2_h,1);
  97   1              HC595SendData(0,1);
  98   1              HC595SendData(2,1);
  99   1      
 100   1              RCK_595=0; //set dataline low
 101   1              _nop_();  //短暂延时
 102   1              _nop_();  //短暂延时
 103   1              RCK_595=1;
 104   1      }
 105          
 106          void display_temperature(int temp_int_2,temp_float2int_2)
 107          {
 108   1              temp_int_2_h=temp_int_2/10;
 109   1              temp_int_2_l=temp_int_2%10;
 110   1              temp_float2int_2_h=temp_float2int_2/10;
 111   1              temp_float2int_2_l=temp_float2int_2%10;
 112   1      
 113   1              HC595SendData(temp_float2int_2_l,1);
 114   1              HC595SendData(temp_float2int_2_h,1);
 115   1              HC595SendData(temp_int_2_l,2);//加个小数点
C51 COMPILER V9.01   74HC595                                                               01/18/2020 16:59:08 PAGE 3   

 116   1              HC595SendData(temp_int_2_h,1);
 117   1              HC595SendData(10,1);
 118   1              HC595SendData(10,1);
 119   1              HC595SendData(10,1);
 120   1              HC595SendData(10,1);
 121   1      
 122   1              RCK_595=0; //set dataline low
 123   1              _nop_();  //短暂延时
 124   1              _nop_();  //短暂延时
 125   1              RCK_595=1;
 126   1      }
 127          
 128          
 129          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    410    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
