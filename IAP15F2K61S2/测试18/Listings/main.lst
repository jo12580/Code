C51 COMPILER V9.01   MAIN                                                                  05/08/2021 23:17:44 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Software\Keil\32\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\main.lst) TABS(2)

line level    source

   1          #include<stc15f2k60s2.h>
   2          #include<intrins.h>
   3          
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6            
   7          sbit DQ=P1^4;
   8          
   9          uchar tab[]={0XC0,0XF9,0XA4,0XB0,0X99,0X92,0X82,0XF8,0X80,0X90,\
  10                       0X40,0X79,0X24,0X30,0X19,0X12,0X02,0X78,0X00,0X10,0XBF,0XFF};
  11          uchar num;
  12          long Wendu;
  13          
  14          uchar DisplayData[9];
  15          void Delayms(int ms);
  16          void Delay500us();
  17          void Delay100us();
  18          void Delay80us();
  19          //void Init_DS18b20(void);
  20          bit Init_DS18b20(void);
  21          void DS18B20_WiteByte(unsigned char dat);
  22          long TemperGet(void);
  23          void datapros();
  24          void Display();
  25                       
  26          void Delay100ms()   //@11.0592MHz
  27          {
  28   1        unsigned char i, j, k;
  29   1      
  30   1        _nop_();
  31   1        _nop_();
  32   1        i = 5;
  33   1        j = 52;
  34   1        k = 195;
  35   1        do
  36   1        {
  37   2          do
  38   2          {
  39   3            while (--k);
  40   3          } while (--j);
  41   2        } while (--i);
  42   1      }
  43          
  44          
  45          void main()
  46          {
  47   1        P2=0XA0;
  48   1        P0=0X00;
  49   1        while(1)
  50   1        {
  51   2          Display();
  52   2          if((Wendu%100000/10000)==8)
  53   2          {
  54   3            P2=0XA0;
C51 COMPILER V9.01   MAIN                                                                  05/08/2021 23:17:44 PAGE 2   

  55   3            P0=0xff;
  56   3            P2=0x80;
  57   3            P0=0xff;
  58   3            Delay100ms();
  59   3            P2=0XA0;
  60   3            P0=0x00;
  61   3            P2=0x80;
  62   3            P0=0x00;
  63   3          }
  64   2        }
  65   1      }
  66          
  67          void Display()
  68          {
  69   1        unsigned int i;
  70   1        datapros();
  71   1        for(i=0;i<=5;i++)
  72   1        {
  73   2          P2=0xc0;
  74   2          switch(i)
  75   2          {
  76   3            case 0:P0=0x01;break;
  77   3            case 1:P0=0x02;break;
  78   3            case 2:P0=0x04;break;
  79   3            case 3:P0=0x08;break;
  80   3            case 4:P0=0x10;break;
  81   3            case 5:P0=0x20;break;
  82   3            case 6:P0=0x40;break;
  83   3            case 7:P0=0x80;break;
  84   3          }
  85   2          P2=0xe0;
  86   2          P0= DisplayData[i];
  87   2          Delayms(1); 
  88   2          P0=0xff;  
  89   2        }
  90   1      }
  91          
  92          void datapros()   
  93          {
  94   1        Wendu=TemperGet();
  95   1        DisplayData[5] = tab[Wendu%10];       
  96   1        DisplayData[4] = tab[Wendu%100/10];        
  97   1        DisplayData[3] = tab[Wendu%1000/100]; 
  98   1        DisplayData[2] = tab[Wendu%10000/1000];         
  99   1        DisplayData[1] = tab[Wendu%100000/10000+10];    
 100   1        DisplayData[0] = tab[Wendu/100000]; 
 101   1        DisplayData[6] = tab[1];      
 102   1        DisplayData[7] = tab[1];  
 103   1      }
 104                      
 105          bit Init_DS18b20(void)
 106          {
 107   1          bit initflag = 0;
 108   1          
 109   1          DQ = 1;
 110   1      
 111   1        Delay500us();
 112   1            DQ = 0;
 113   1      
 114   1        Delay500us();
 115   1            DQ = 1;
 116   1        Delay500us();
C51 COMPILER V9.01   MAIN                                                                  05/08/2021 23:17:44 PAGE 3   

 117   1            initflag = DQ; 
 118   1          Delay500us();
 119   1            return initflag;
 120   1      
 121   1      }
 122          
 123          void DS18B20_WiteByte(unsigned char dat)
 124          {
 125   1        unsigned char i;
 126   1        for(i=0;i<8;i++)
 127   1        {
 128   2          DQ=0;
 129   2          DQ=dat&0x01;//1100 1100 & 0000 0001 = 0000 0000
 130   2          Delay80us();
 131   2          DQ=1;
 132   2          dat >>=1; //  0110 0110  //0011 0011 // 0000 0000
 133   2        }
 134   1      }
 135          
 136          unsigned char DS18B20_ReadByte(void)
 137          {
 138   1        unsigned char i;
 139   1        unsigned char dat;//0000 0000 
 140   1        
 141   1        for(i=0;i<8;i++)
 142   1        {
 143   2          DQ=0;
 144   2          dat >>=1;          // 0101 0000 
 145   2          DQ=1;
 146   2          if(DQ==1)
 147   2          {
 148   3            dat=dat|0x80;  // 0000 0000 | 1000 0000 = 1000 0000
 149   3          }
 150   2          Delay80us();
 151   2        }
 152   1        
 153   1        return dat;
 154   1      }
 155          
 156          long TemperGet(void)
 157          {
 158   1        unsigned char h,l;
 159   1        long temp;
 160   1        Init_DS18b20();
 161   1        DS18B20_WiteByte(0xcc);
 162   1        DS18B20_WiteByte(0x44);
 163   1        Delay500us();
 164   1        Init_DS18b20();
 165   1        DS18B20_WiteByte(0xcc);
 166   1        DS18B20_WiteByte(0xbe);
 167   1        l=DS18B20_ReadByte();
 168   1        h=DS18B20_ReadByte();
 169   1        temp=h<<8;
 170   1        temp|=l;
 171   1        temp=temp*625;
 172   1        return temp;
 173   1      }
 174          
 175          void Delay80us()    //@11.0592MHz
 176          {
 177   1        unsigned char i, j;
 178   1      
C51 COMPILER V9.01   MAIN                                                                  05/08/2021 23:17:44 PAGE 4   

 179   1        _nop_();
 180   1        i = 1;
 181   1        j = 217;
 182   1        do
 183   1        {
 184   2          while (--j);
 185   2        } while (--i);
 186   1      }
 187          
 188          //void Delay100us()   //@11.0592MHz
 189          //{
 190          //  unsigned char i, j;
 191          
 192          //  _nop_();
 193          //  _nop_();
 194          //  i = 2;
 195          //  j = 15;
 196          //  do
 197          //  {
 198          //    while (--j);
 199          //  } while (--i);
 200          //}
 201          
 202          void Delay500us()   //@11.0592MHz
 203          {
 204   1        unsigned char i, j;
 205   1      
 206   1        _nop_();
 207   1        _nop_();
 208   1        i = 6;
 209   1        j = 93;
 210   1        do
 211   1        {
 212   2          while (--j);
 213   2        } while (--i);
 214   1      }
 215          
 216          void Delayms(int ms)
 217          {
 218   1        int i,j;
 219   1        for(i=0;i<ms;i++)
 220   1          for(j=845;j>0;j--);
 221   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    707    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     36      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
