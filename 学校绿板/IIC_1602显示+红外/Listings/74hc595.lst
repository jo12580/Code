C51 COMPILER V9.57.0.0   74HC595                                                           12/01/2021 17:06:10 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE 74HC595
OBJECT MODULE PLACED IN .\Objects\74hc595.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 74hc595.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\7
                    -4hc595.lst) TABS(2) OBJECT(.\Objects\74hc595.obj)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          #include "74hc595.h"
   4          
   5          unsigned char year_2_h,year_2_l,month_2_h,month_2_l,day_2_h,day_2_l,
   6                hour_2_h,hour_2_l,min_2_h,min_2_l,sec_2_h,sec_2_l,week_2_h,week_2_l;
   7          int temp_int_2_h,temp_int_2_l,temp_float2int_2_h,temp_float2int_2_l;
   8          
   9          unsigned char code led_code[] =
  10          //{0xff,0xff,0x01,0x02,0x04,
  11          //0x08,0x10,0x20,0x40,0x80};  //数码管测试代码
  12          
  13          //{ 0x84, 0xF5, 0x4C, 0x64, 0x35, 0x26, 
  14          //0x06, 0xF4, 0x04, 0x24, 0x14, 0x07, 
  15          //0x8E, 0x45, 0x0E, 0x1E, 0x7F, 0xFB };//6位管代码，右进 版本为：2019-12-30 蓝色
  16          ////以集成电路1脚位置算起，1-7，2-8，3-6，4-5，5-3，6-4，7-2，8-1  
  17          
  18          { 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 
  19          0x82, 0xF8, 0x80, 0x90, 0x88, 0x83, 
  20          0xC6, 0xA1, 0x86, 0x8E, 0xBF, 0x7F };
  21          //6位管代码，右进，版本为：2019-09-11红色，2019-12-02绿色 或2019-12-30 绿色
  22          //以集成电路1脚位置算起，1-6，2-7，3-5，4-4，5-8，6-3，7-2，8-1
  23          
  24          //{ 0x82, 0xAF, 0xC4, 0x85, 0xA9, 0x91, 
  25          //0x90, 0xA7, 0x80, 0x81, 0xA0, 0x98, 
  26          //0xD2, 0x8C, 0xD0, 0xF0, 0xFD, 0x7F };//4位管代码，左进
  27          
  28          
  29          //{0xff,0xff,0xc6,0xf6,0xf0,
  30          //0x08,0x10,0x20,0x40,0x80};  //外框程序
  31          
  32          void HC595SendData(unsigned char SendVal,unsigned char ctr)
  33          {  
  34   1        unsigned char i,m;
  35   1        m=led_code[SendVal];
  36   1          if(ctr==2) m=m&0xdf;//加个小数点
  37   1            
  38   1        for(i=0;i<8;i++) 
  39   1        {
  40   2            SCK_595=0;
  41   2          if(m&0x80) 
  42   2          DATA_595=1;                                                                                             
             -                                                                                                                  //set 
             -dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  43   2          else 
  44   2          DATA_595=0;
  45   2          m=m<<1;
  46   2          SCK_595=1;  
  47   2          _nop_();   //短暂延时产生一定宽度的脉冲信号
  48   2          _nop_();   //短暂延时 
  49   2        }
  50   1        /*以下四条语句不能放在此函数里，不然会有闪烁感
  51   1        RCK_595=0; //set dataline low
  52   1        _nop_();  //短暂延时
C51 COMPILER V9.57.0.0   74HC595                                                           12/01/2021 17:06:10 PAGE 2   

  53   1        _nop_();  //短暂延时
  54   1        RCK_595=1;
  55   1        应放在显示函数的后面（每传输完一组数据再拉高）*/      
  56   1      }
  57          
  58          void display_time(unsigned char hour_2,min_2,sec_2,week_2)
  59          {
  60   1        hour_2_h=hour_2/10;
  61   1        hour_2_l=hour_2%10;
  62   1        min_2_h=min_2/10;
  63   1        min_2_l=min_2%10;
  64   1        sec_2_h=sec_2/10;
  65   1        sec_2_l=sec_2%10;
  66   1        week_2_h=week_2/10;
  67   1        week_2_l=week_2%10;
  68   1        
  69   1        HC595SendData(sec_2_l,1);
  70   1        HC595SendData(sec_2_h,1);
  71   1        HC595SendData(min_2_l,1);
  72   1        HC595SendData(min_2_h,1);
  73   1        HC595SendData(hour_2_l,1);
  74   1        HC595SendData(hour_2_h,1);
  75   1        HC595SendData(10,1);
  76   1        HC595SendData(week_2_l,1);
  77   1        
  78   1        RCK_595=0; //set dataline low
  79   1        _nop_();  //短暂延时
  80   1        _nop_();  //短暂延时
  81   1        RCK_595=1;
  82   1      
  83   1      }
  84          
  85          void display_date(unsigned char year_2,month_2,day_2)
  86          {
  87   1        year_2_h=year_2/10;
  88   1        year_2_l=year_2%10;
  89   1        month_2_h=month_2/10;
  90   1        month_2_l=month_2%10;
  91   1        day_2_h=day_2/10;
  92   1        day_2_l=day_2%10;
  93   1      
  94   1        HC595SendData(day_2_l,1);
  95   1        HC595SendData(day_2_h,1);
  96   1        HC595SendData(month_2_l,1);
  97   1        HC595SendData(month_2_h,1);
  98   1        HC595SendData(year_2_l,1);
  99   1        HC595SendData(year_2_h,1);
 100   1        HC595SendData(0,1);
 101   1        HC595SendData(2,1);
 102   1      
 103   1        RCK_595=0; //set dataline low
 104   1        _nop_();  //短暂延时
 105   1        _nop_();  //短暂延时
 106   1        RCK_595=1;
 107   1      }
 108          
 109          void display_temperature(int temp_int_2,temp_float2int_2)
 110          {
 111   1        temp_int_2_h=temp_int_2/10;
 112   1        temp_int_2_l=temp_int_2%10;
 113   1        temp_float2int_2_h=temp_float2int_2/10;
 114   1        temp_float2int_2_l=temp_float2int_2%10;
C51 COMPILER V9.57.0.0   74HC595                                                           12/01/2021 17:06:10 PAGE 3   

 115   1      
 116   1        HC595SendData(temp_float2int_2_l,1);
 117   1        HC595SendData(temp_float2int_2_h,1);
 118   1        HC595SendData(temp_int_2_l,2);//加个小数点
 119   1        HC595SendData(temp_int_2_h,1);
 120   1        HC595SendData(10,1);
 121   1        HC595SendData(10,1);
 122   1        HC595SendData(10,1);
 123   1        HC595SendData(10,1);
 124   1      
 125   1        RCK_595=0; //set dataline low
 126   1        _nop_();  //短暂延时
 127   1        _nop_();  //短暂延时
 128   1        RCK_595=1;
 129   1      }
 130          
 131          
 132          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    410    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
