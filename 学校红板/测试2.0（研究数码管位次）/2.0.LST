C51 COMPILER V9.01   2_0                                                                   04/05/2020 16:41:01 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 2_0
OBJECT MODULE PLACED IN 2.0.OBJ
COMPILER INVOKED BY: C:\软件\C51\BIN\C51.EXE 2.0.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          实验说明：
   3                  
   4          实验接线：
   5                  动态数码管模块-->单片机管脚
   6                  参考动态数码管实验接线（开发攻略内在对应的实验章节内实验现象有接线说明）
   7                  矩阵按键模块-->单片机管脚
   8                  参考矩阵按键实验接线（开发攻略内在对应的实验章节内实验现象有接线说明）
   9          实验现象：
  10                  按下矩阵按键在数码管上逐个显示对应的键值，键值如下：
  11                  S1-S4：0-3
  12                  S4-S8：4-7
  13                  S9-S12：8-B
  14                  S13-S16：C-F
  15          */
  16          #include<reg51.h>
  17          
  18          #define GPIO_DIG P0
  19          #define GPIO_KEY P1
  20          
  21          sbit LSA=P2^2;
  22          sbit LSB=P2^3;
  23          sbit LSC=P2^4;
  24          
  25          unsigned char code DIG_CODE[17]={
  26          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  27          0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  28          //0、1、2、3、4、5、6、7、8、9、A、b、C、d、E、F的显示码
  29          unsigned char KeyValue;
  30          //用来存放读取到的键值
  31          unsigned char KeyState; //记录按键的状态，0没有，1有
  32          unsigned char DisplayData[8];//用来存放要显示的8位数的值
  33          void Delay10ms();   //延时10ms
  34          void KeyDown();          //检测按键函数
  35          void DigDisplay(); //动态显示函数
  36          
  37          void main(void)
  38          {
  39   1              KeyState=0;
  40   1              while(1)
  41   1              {
  42   2                      KeyDown();
  43   2                      if(KeyState==1)
  44   2                      {
  45   3                              DisplayData[7]=DisplayData[6];
  46   3                              DisplayData[6]=DisplayData[5];
  47   3                              DisplayData[5]=DisplayData[4];
  48   3                              DisplayData[4]=DisplayData[3];
  49   3                              DisplayData[3]=DisplayData[2];
  50   3                              DisplayData[2]=DisplayData[1];
  51   3                              DisplayData[1]=DisplayData[0];
  52   3                              DisplayData[0]=DIG_CODE[KeyValue];
  53   3                              
  54   3                              KeyState=0;
  55   3                      }
C51 COMPILER V9.01   2_0                                                                   04/05/2020 16:41:01 PAGE 2   

  56   2                      DigDisplay();
  57   2              }                               
  58   1      }
  59          
  60          
  61          
  62          void DigDisplay()
  63          {
  64   1              unsigned char i;
  65   1              unsigned int j;
  66   1              for(i=0;i<8;i++)
  67   1              {
  68   2                      switch(i)        //位选，选择点亮的数码管，
  69   2                      {
  70   3                              case(0):
  71   3                                      LSA=1;LSB=1;LSC=1; break;//显示第7位
  72   3                              case(1):
  73   3                                      LSA=0;LSB=1;LSC=1; break;//显示第6位
  74   3                              case(2):
  75   3                                      LSA=1;LSB=0;LSC=1; break;//显示第5位
  76   3                              case(3):
  77   3                                      LSA=0;LSB=0;LSC=1; break;//显示第4位
  78   3                              case(4):
  79   3                                      LSA=1;LSB=1;LSC=0; break;//显示第3位 
  80   3                              case(5):
  81   3                                      LSA=0;LSB=1;LSC=0; break;//显示第2位 
  82   3                              case(6):
  83   3                                      LSA=1;LSB=0;LSC=0; break;//显示第1位 
  84   3                              case(7):
  85   3                                      LSA=0;LSB=0;LSC=0; break;//显示第0位    
  86   3                      }
  87   2                      GPIO_DIG=DisplayData[i];//发送段码
  88   2                      j=10;                                            //扫描间隔时间设定
  89   2                      while(j--);     
  90   2                      GPIO_DIG=0x00;//消隐
  91   2              }
  92   1      }
  93          
  94          
  95          
  96          void KeyDown(void)
  97          {
  98   1              unsigned int a=0;
  99   1              GPIO_KEY=0x0f;
 100   1              if(GPIO_KEY!=0x0f)
 101   1        {
 102   2                      Delay10ms();
 103   2                      a++;    
 104   2                      a=0;
 105   2                      if(GPIO_KEY!=0x0f)
 106   2                      {
 107   3                              KeyState=1;//有按键按下
 108   3                              //测试列
 109   3                              GPIO_KEY=0X0F;
 110   3      //                      Delay10ms();
 111   3                              switch(GPIO_KEY)
 112   3                              {
 113   4                                      case(0X07):     KeyValue=0;break;
 114   4                                      case(0X0b):     KeyValue=1;break;
 115   4                                      case(0X0d): KeyValue=2;break;
 116   4                                      case(0X0e):     KeyValue=3;break;
 117   4      //                              default:        KeyValue=17;    //检测出错回复17意思是把数码管全灭掉。
C51 COMPILER V9.01   2_0                                                                   04/05/2020 16:41:01 PAGE 3   

 118   4                              }
 119   3                              //测试行
 120   3                              GPIO_KEY=0XF0;
 121   3                              Delay10ms();
 122   3                              switch(GPIO_KEY)
 123   3                              {
 124   4                                      case(0X70):     KeyValue=KeyValue;break;
 125   4                                      case(0Xb0):     KeyValue=KeyValue+4;break;
 126   4                                      case(0Xd0): KeyValue=KeyValue+8;break;
 127   4                                      case(0Xe0):     KeyValue=KeyValue+12;break;
 128   4      //                              default:        KeyValue=17;
 129   4                              }
 130   3                              while((a<500)&&(GPIO_KEY!=0xf0))         //按键松手检测
 131   3                              {
 132   4                                      Delay10ms();
 133   4                                      a++;
 134   4                              }
 135   3                              a=0;
 136   3                      }
 137   2              }
 138   1      }
 139          
 140          void Delay10ms(void)   
 141          {
 142   1          unsigned char a,b,c;
 143   1          for(c=1;c>0;c--)
 144   1              for(b=38;b>0;b--)
 145   1                  for(a=130;a>0;a--);
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    338    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
