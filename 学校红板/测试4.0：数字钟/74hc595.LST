C51 COMPILER V9.01   74HC595                                                               03/27/2021 12:05:01 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 74HC595
OBJECT MODULE PLACED IN 74hc595.OBJ
COMPILER INVOKED BY: D:\Software\Keil\32\C51\BIN\C51.EXE 74hc595.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          #include "74hc595.h"
   4          
   5          unsigned char year_2_h,year_2_l,month_2_h,month_2_l,day_2_h,day_2_l,
   6                hour_2_h,hour_2_l,min_2_h,min_2_l,sec_2_h,sec_2_l,week_2_h,week_2_l;
   7          int temp_int_2_h,temp_int_2_l,temp_float2int_2_h,temp_float2int_2_l;
   8          
   9          unsigned char code led_code[] =
  10          //{0xff,0xff,0x01,0x02,0x04,
  11          //0x08,0x10,0x20,0x40,0x80};  //此为测试代码
  12          
  13          { 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 
  14          0x82, 0xF8, 0x80, 0x90, 0x88, 0x83,
  15          0xC6, 0xA1, 0x86, 0x8E, 0xBF, 0x7F };
  16          
  17          //{ 0x82, 0xAF, 0xC4, 0x85, 0xA9, 0x91, 
  18          //0x90, 0xA7, 0x80, 0x81, 0xA0, 0x98, 
  19          //0xD2, 0x8C, 0xD0, 0xF0, 0xFD, 0x7F };
  20          
  21          
  22          void HC595SendData(unsigned char SendVal,unsigned char ctr)
  23          {  
  24   1        unsigned char i,m;
  25   1        m=led_code[SendVal];
  26   1      
  27   1        if(ctr==2) m=m&0xbf;//加个小数点  //1010 1101
  28   1            
  29   1        for(i=0;i<8;i++) 
  30   1        {
  31   2            SCK_595=0;
  32   2          if(m&0x80) 
  33   2          DATA_595=1;                                                                                             
             -                                                                                                                  //set 
             -dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  34   2          else 
  35   2          DATA_595=0;
  36   2          m=m<<1;
  37   2          SCK_595=1;  
  38   2          _nop_();   //短暂延时产生一定宽度的脉冲信号
  39   2          _nop_();   //短暂延时 
  40   2        }
  41   1        /*以下四条语句不能放在此函数里，不然会有闪烁感
  42   1        RCK_595=0; //set dataline low
  43   1        _nop_();  //短暂延时
  44   1        _nop_();  //短暂延时
  45   1        RCK_595=1;
  46   1        应放在显示函数的后面（每传输完一组数据再拉高）*/      
  47   1      }
  48          
  49          void display_time(unsigned char hour_2,min_2,sec_2,week_2)
  50          {
  51   1        hour_2_h=hour_2/10;
  52   1        hour_2_l=hour_2%10;
  53   1        min_2_h=min_2/10;
C51 COMPILER V9.01   74HC595                                                               03/27/2021 12:05:01 PAGE 2   

  54   1        min_2_l=min_2%10;
  55   1        sec_2_h=sec_2/10;
  56   1        sec_2_l=sec_2%10;
  57   1        week_2_h=week_2/10;
  58   1        week_2_l=week_2%10;
  59   1      
  60   1        HC595SendData(10,1);  
  61   1        HC595SendData(week_2_l,1);
  62   1      
  63   1        HC595SendData(hour_2_h,1);
  64   1        HC595SendData(hour_2_l,1);
  65   1        
  66   1        HC595SendData(min_2_h,1);   
  67   1        HC595SendData(min_2_l,1); 
  68   1      
  69   1        HC595SendData(sec_2_h,1);
  70   1        HC595SendData(sec_2_l,1);
  71   1      
  72   1      
  73   1        
  74   1      //  HC595SendData(sec_2_l,1);
  75   1      //  HC595SendData(sec_2_h,1);
  76   1      //  HC595SendData(min_2_l,1);
  77   1      //  HC595SendData(min_2_h,1);
  78   1      //  HC595SendData(hour_2_l,1);
  79   1      //  HC595SendData(hour_2_h,1);
  80   1      //  HC595SendData(10,1);
  81   1      //  HC595SendData(week_2_l,1);
  82   1        
  83   1        RCK_595=0; //set dataline low
  84   1        _nop_();  //短暂延时
  85   1        _nop_();  //短暂延时
  86   1        RCK_595=1;
  87   1      
  88   1      }
  89          
  90          //void display_date(unsigned char year_2,month_2,day_2)
  91          //{
  92          //  year_2_h=year_2/10;
  93          //  year_2_l=year_2%10;
  94          //  month_2_h=month_2/10;
  95          //  month_2_l=month_2%10;
  96          //  day_2_h=day_2/10;
  97          //  day_2_l=day_2%10;
  98          
  99          //  HC595SendData(day_2_l,1);
 100          //  HC595SendData(day_2_h,1);
 101          //  HC595SendData(month_2_l,1);
 102          //  HC595SendData(month_2_h,1);
 103          //  HC595SendData(year_2_l,1);
 104          //  HC595SendData(year_2_h,1);
 105          //  HC595SendData(0,1);
 106          //  HC595SendData(2,1);
 107          
 108          //  RCK_595=0; //set dataline low
 109          //  _nop_();  //短暂延时
 110          //  _nop_();  //短暂延时
 111          //  RCK_595=1;
 112          //}
 113          
 114          //void display_temperature(int temp_int_2,temp_float2int_2)
 115          //{
C51 COMPILER V9.01   74HC595                                                               03/27/2021 12:05:01 PAGE 3   

 116          //  temp_int_2_h=temp_int_2/10;
 117          //  temp_int_2_l=temp_int_2%10;
 118          //  temp_float2int_2_h=temp_float2int_2/10;
 119          //  temp_float2int_2_l=temp_float2int_2%10;
 120          
 121          //  HC595SendData(temp_float2int_2_l,1);
 122          //  HC595SendData(temp_float2int_2_h,1);
 123          //  HC595SendData(temp_int_2_l,2);//加个小数点
 124          //  HC595SendData(temp_int_2_h,1);
 125          //  HC595SendData(10,1);
 126          //  HC595SendData(10,1);
 127          //  HC595SendData(10,1);
 128          //  HC595SendData(10,1);
 129          
 130          //  RCK_595=0; //set dataline low
 131          //  _nop_();  //短暂延时
 132          //  _nop_();  //短暂延时
 133          //  RCK_595=1;
 134          //}
 135          
 136          
 137          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    185    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
